# This file contains all of the settings for TravisCI, which is the
# continuous integration system used with strax.  For more information,
# see: https://travis-ci.org
#
# Miniconda is used to provide fine control over Python versions, even
# though it isn't required for strax.

dist: trusty # Ubuntu distribution
language: generic  # This needs to be set for OSX support

# Caching the Python dependencies speeds up builds and lightens
# the load on TravisCI
cache: pip  

# Everything should work in userspace
sudo: false

# The build matrix over all possible setups
matrix:
    include:
        - os: osx
          env: PYTHON=3.6.5
        - env: PYTHON=3.6.5
        - os: osx
          env: PYTHON=3.6
        - env: PYTHON=3.6
        
# Setup miniconda
before_install:
    # Fetch miniconda
    - if [ "${TRAVIS_OS_NAME}" == "osx" ]; then wget https://repo.continuum.io/miniconda/Miniconda3-latest-MacOSX-x86_64.sh -O miniconda.sh; fi
    - if [ "${TRAVIS_OS_NAME}" == "linux" ]; then wget https://repo.continuum.io/miniconda/Miniconda3-latest-Linux-x86_64.sh -O miniconda.sh; fi

    # Install
    - chmod +x miniconda.sh
    - ./miniconda.sh -b -p $HOME/miniconda
    
    # Setup miniconda and environment
    - export PATH=$HOME/miniconda/bin:$PATH
    - conda config --set always_yes yes --set changeps1 no
    - conda create -q -n strax python=${PYTHON}
    - source activate strax

# This is the actual install of strax
install:
  - pip install -r requirements.txt
  - pip install coveralls
  - python setup.py install
  
# Compute the code coverage
script:
  - coverage run --source=strax setup.py test

# Upload code coverage information
after_success:
  - coveralls
