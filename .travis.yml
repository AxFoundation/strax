# This file contains all of the settings for TravisCI, which is the
# continuous integration system used with strax.  For more information,
# see: https://travis-ci.org
#
# Miniconda is used to provide fine control over Python versions, even
# though it isn't required for strax.

dist: trusty # Ubuntu distribution
language: generic  # This needs to be set for OSX support

# Caching the Python dependencies speeds up builds and lightens
# the load on TravisCI
cache: pip  

# Everything should work in userspace
sudo: false

# Deploy releases to PyPI for pip installs
# See https://docs.travis-ci.com/user/encryption-keys/
deploy:
  provider: pypi
  user: "AxFoundation"
  password:  # The following is encrypted FYI
    secure: "m0xZzEAbrDaYCiCp11Bfo9jamfXrJPTUFOr7OLJy1ScaiqCqaJB/1J0ZOeitPNXIfJZ4UNkP6JqQHETg6bqSHi41qJS+0iBIGB3UWNvUDI6o+zKHHrLQ1md2aOuuY+7+KrGytwUbiXg3BsK4dk62mq9k1Ziv7SD0bB1tYYF4wLDaAwccNwM0tgJEUxgr3fsxCXMsFMtSmKjGxRwi2/Qb3m9hpphdOO5WHbDB4G28gBAgA3io8vL+V6z2UTCeaoWxuDqmVmeoRdUpNkljwazyx7CyucsYxtJ/Bt9iRVY/LGkF/HyyiMKd33dVlMKK8pgDHJ17HJNsulbCxdG8wyL7CW8WJyG4LfZrbtLY6y7sWb7I8cN5+AbO8e2O43PdkiUXr+1yBGinikRB7rzeV+0uBqIaMszTVeC/jSacRoT+5eXa7TY9aMrZb09rIdwLcqpSAB0lUS5uCCQfB4QQ6kgic0FQ0DC/nCech+xhTSSBuWd6hVdnEL/+GnvZQLZJTW5wEW+INKScg9yS9YKiI88BiSrWtemEP/39P69CHFu3A3wrw1UbBGxk9GFpmMkadYvH1CSp9Tq9r8V60WcVoRKyhGxxbcOOV3J2CCyIeRnw9oUJWyrJYe1e8OMJdFC1LRW2rGXTO2phJ1JYrVajgM+cUlj/o/rrhk8uRBNIM3M3ipQ="
  on:
    tags: true  # Only upload tags from bumpversion
    
# The build matrix over all possible setups
matrix:
    include:
        - os: osx
          env: PYTHON=3.6.5
        - env: PYTHON=3.6.5
        - os: osx
          env: PYTHON=3.6
        - env: PYTHON=3.6
        
# Setup miniconda
before_install:
    # Fetch miniconda
    - if [ "${TRAVIS_OS_NAME}" == "osx" ]; then wget https://repo.continuum.io/miniconda/Miniconda3-latest-MacOSX-x86_64.sh -O miniconda.sh; fi
    - if [ "${TRAVIS_OS_NAME}" == "linux" ]; then wget https://repo.continuum.io/miniconda/Miniconda3-latest-Linux-x86_64.sh -O miniconda.sh; fi

    # Install
    - chmod +x miniconda.sh
    - ./miniconda.sh -b -p $HOME/miniconda
    
    # Setup miniconda and environment
    - export PATH=$HOME/miniconda/bin:$PATH
    - conda config --set always_yes yes --set changeps1 no
    - conda create -q -n strax python=${PYTHON}
    - source activate strax

# This is the actual install of strax
install:
  - pip install -r requirements.txt
  - pip install coveralls
  - python setup.py install
  
# Compute the code coverage
script:
  - coverage run --source=strax setup.py test

# Upload code coverage information
after_success:
  - coveralls
