# This file contains all of the settings for TravisCI, which is the
# continuous integration system used with strax.  For more information,
# see: https://travis-ci.org

dist: trusty # Ubuntu distribution
language: generic

# Caching the Python dependencies speeds up builds and lightens
# the load on TravisCI
cache: pip  

# Everything should work in userspace
sudo: false


matrix:
    include:
        - os: osx
          env: PYTHON=3.6.5
        - env: PYTHON=3.6.5
        - os: osx
          env: PYTHON=3.6
        - env: PYTHON=3.6
        

# Based on:
#   https://github.com/numba/numba/blob/master/buildscripts/incremental/install_miniconda.sh
before_install:
    - if [ "${TRAVIS_OS_NAME}" == "osx" ]; then curl --silent http://repo.continuum.io/miniconda/Miniconda-latest-MacOSX-x86_64.sh -o miniconda.sh; fi
    - if [ "${TRAVIS_OS_NAME}" == "linux" ]; then wget -nv http://repo.continuum.io/miniconda/Miniconda3-latest-Linux-x86_64.sh -O miniconda.sh; fi
  
    - chmod +x miniconda.sh
    - ./miniconda.sh -b
    
    # Based on XENON1T/pax's .travis.yml
    - export PATH=$HOME/miniconda3/bin:$PATH
    - conda config --set always_yes yes --set changeps1 no
    - conda create -q -n strax python=${PYTHON}
    - source activate strax

install:
  - pip install -r requirements.txt
  - pip install coveralls
  - python setup.py install
  
script:
  - coverage run --source=strax setup.py test
  
after_success:
  - coveralls
